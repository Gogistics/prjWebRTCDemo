/*! webrtc 20-10-2016 */function trace(text){"\n"==text[text.length-1]&&(text=text.substring(0,text.length-1)),console.log((performance.now()/1e3).toFixed(3)+": "+text)}function maybeFixConfiguration(pcConfig){if(pcConfig)for(var i=0;i<pcConfig.iceServers.length;i++)pcConfig.iceServers[i].hasOwnProperty("urls")&&(pcConfig.iceServers[i].url=pcConfig.iceServers[i].urls,delete pcConfig.iceServers[i].urls)}function getPlugin(){return document.getElementById("WebrtcEverywherePluginId")}function requestUserMedia(constraints){return new Promise(function(resolve,reject){var onSuccess=function(stream){resolve(stream)},onError=function(error){reject(error)};try{navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,navigator.getUserMedia(constraints,onSuccess,onError)}catch(e){reject(e)}})}var RTCPeerConnection=null,getUserMedia=null,attachMediaStream=null,drawImage=null,reattachMediaStream=null,webrtcDetectedBrowser=null,webrtcDetectedVersion=null;if(window.performance=window.performance||{},window.performance.now=window.performance.now||function(){var now=Date.now();return function(){return Date.now()-now}}(),window.URL=window.URL||window.webkitURL,drawImage=function(context,video,x,y,width,height){context.drawImage(video,x,y,width,height)},attachEventListener=function(video,type,listener,useCapture){video.addEventListener(type,listener,useCapture)},navigator.mozGetUserMedia){console.log("This appears to be Firefox"),webrtcDetectedBrowser="firefox",webrtcDetectedVersion=parseInt(navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1],10);var RTCPeerConnection=function(pcConfig,pcConstraints){return maybeFixConfiguration(pcConfig),new mozRTCPeerConnection(pcConfig,pcConstraints)};RTCSessionDescription=mozRTCSessionDescription,RTCIceCandidate=mozRTCIceCandidate,getUserMedia=navigator.mozGetUserMedia.bind(navigator),navigator.getUserMedia=getUserMedia,createIceServer=function(url,username,password){var iceServer=null,url_parts=url.split(":");if(0===url_parts[0].indexOf("stun"))iceServer={url:url};else if(0===url_parts[0].indexOf("turn"))if(webrtcDetectedVersion<27){var turn_url_parts=url.split("?");1!==turn_url_parts.length&&0!==turn_url_parts[1].indexOf("transport=udp")||(iceServer={url:turn_url_parts[0],credential:password,username:username})}else iceServer={url:url,credential:password,username:username};return iceServer},createIceServers=function(urls,username,password){var iceServers=[];for(i=0;i<urls.length;i++){var iceServer=createIceServer(urls[i],username,password);null!==iceServer&&iceServers.push(iceServer)}return iceServers},attachMediaStream=function(element,stream){return console.log("Attaching media stream"),element.mozSrcObject=stream,element.play(),element},reattachMediaStream=function(to,from){console.log("Reattaching media stream"),to.mozSrcObject=from.mozSrcObject,to.play()}}else if(navigator.webkitGetUserMedia){console.log("This appears to be Chrome"),webrtcDetectedBrowser="chrome";var result=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);webrtcDetectedVersion=null!==result?parseInt(result[2],10):999,createIceServer=function(url,username,password){var iceServer=null,url_parts=url.split(":");return 0===url_parts[0].indexOf("stun")?iceServer={url:url}:0===url_parts[0].indexOf("turn")&&(iceServer={url:url,credential:password,username:username}),iceServer},createIceServers=function(urls,username,password){var iceServers=[];if(webrtcDetectedVersion>=34)iceServers={urls:urls,credential:password,username:username};else for(i=0;i<urls.length;i++){var iceServer=createIceServer(urls[i],username,password);null!==iceServer&&iceServers.push(iceServer)}return iceServers};var RTCPeerConnection=function(pcConfig,pcConstraints){return webrtcDetectedVersion<34&&maybeFixConfiguration(pcConfig),new webkitRTCPeerConnection(pcConfig,pcConstraints)};getUserMedia=navigator.webkitGetUserMedia.bind(navigator),navigator.getUserMedia=getUserMedia,attachMediaStream=function(element,stream){return"undefined"!=typeof element.srcObject?element.srcObject=stream:"undefined"!=typeof element.mozSrcObject?element.mozSrcObject=stream:"undefined"!=typeof element.src?stream?element.src=URL.createObjectURL(stream):element.src&&"undefined"!=typeof URL.revokeObjectURL&&(URL.revokeObjectURL(element.src),element.src=null):console.log("Error attaching stream to element."),element},reattachMediaStream=function(to,from){to.src=from.src}}else{var console=console||{log:function(msg){}},createIceServer=function(url,username,password){var url_parts=url.split(":");return 0===url_parts[0].indexOf("stun")?{url:url}:0===url_parts[0].indexOf("turn")?{url:url,credential:password,username:username}:null},extractPluginObj=function(elt){return elt.isWebRtcPlugin?elt:elt.pluginObj},attachEventListener=function(elt,type,listener,useCapture){var _pluginObj=extractPluginObj(elt);_pluginObj?_pluginObj.bindEventListener(type,listener,useCapture):"undefined"!=typeof elt.addEventListener?elt.addEventListener(type,listener,useCapture):"undefined"!=typeof elt.addEvent&&elt.addEventListener("on"+type,listener,useCapture)},installPlugin=function(){if(!document.getElementById("WebrtcEverywherePluginId")){console.log("installPlugin() called");var isInternetExplorer=!!(Object.getOwnPropertyDescriptor&&Object.getOwnPropertyDescriptor(window,"ActiveXObject")||"ActiveXObject"in window),isSafari=!!navigator.userAgent.indexOf("Safari"),pluginObj=document.createElement("object");isInternetExplorer?(pluginObj.setAttribute("classid","CLSID:7FD49E23-C8D7-4C4F-93A1-F7EACFA1EC53"),isInternetExplorer=!0):pluginObj.setAttribute("type","application/webrtc-everywhere"),pluginObj.setAttribute("id","WebrtcEverywherePluginId"),document.body.appendChild(pluginObj),pluginObj.setAttribute("width","0"),pluginObj.setAttribute("height","0"),pluginObj.isWebRtcPlugin||"undefined"!=typeof navigator.plugins&&(navigator.plugins["WebRTC Everywhere"]||navigator.plugins["WebRTC Everywhere Plug-in for Safari"])?(console.log("Plugin version: "+pluginObj.versionName+", adapter version: 1.3.1"),isInternetExplorer?(console.log("This appears to be Internet Explorer"),webrtcDetectedBrowser="Internet Explorer"):isSafari&&(console.log("This appears to be Safari"),webrtcDetectedBrowser="Safari")):console.log("Browser does not appear to be WebRTC-capable")}};document.body?installPlugin():(attachEventListener(window,"load",function(){console.log("onload"),installPlugin()}),attachEventListener(document,"readystatechange",function(){console.log("onreadystatechange:"+document.readyState),"complete"==document.readyState&&installPlugin()}));var getUserMediaDelayed;getUserMedia=navigator.getUserMedia=function(constraints,successCallback,errorCallback){"complete"!==document.readyState?(console.log("readyState = "+document.readyState+", delaying getUserMedia..."),getUserMediaDelayed||(getUserMediaDelayed=!0,attachEventListener(document,"readystatechange",function(){getUserMediaDelayed&&"complete"==document.readyState&&(getUserMediaDelayed=!1,getPlugin().getUserMedia(constraints,successCallback,errorCallback))}))):getPlugin().getUserMedia(constraints,successCallback,errorCallback)},attachMediaStream=function(element,stream){if(console.log("Attaching media stream"),!element)return null;if(element.isWebRtcPlugin)return element.src=stream,element;if("video"===element.nodeName.toLowerCase()){if(!element.pluginObj&&stream){var _pluginObj=document.createElement("object"),_isIE=Object.getOwnPropertyDescriptor&&Object.getOwnPropertyDescriptor(window,"ActiveXObject")||"ActiveXObject"in window;if(_isIE){var windowlessParam=document.createElement("param");windowlessParam.setAttribute("name","windowless"),windowlessParam.setAttribute("value",!0),_pluginObj.appendChild(windowlessParam),_pluginObj.setAttribute("classid","CLSID:7FD49E23-C8D7-4C4F-93A1-F7EACFA1EC53")}else _pluginObj.setAttribute("type","application/webrtc-everywhere");element.pluginObj=_pluginObj,_pluginObj.setAttribute("className",element.className),_pluginObj.setAttribute("innerHTML",element.innerHTML);var width=element.getAttribute("width"),height=element.getAttribute("height"),bounds=element.getBoundingClientRect();if(width||(width=bounds.right-bounds.left),height||(height=bounds.bottom-bounds.top),"getComputedStyle"in window){var computedStyle=window.getComputedStyle(element,null);width||"auto"==computedStyle.width||"0px"==computedStyle.width||(width=computedStyle.width),height||"auto"==computedStyle.height||"0px"==computedStyle.height||(height=computedStyle.height)}width?_pluginObj.setAttribute("width",width):_pluginObj.setAttribute("autowidth",!0),height?_pluginObj.setAttribute("height",height):_pluginObj.setAttribute("autoheight",!0),document.body.appendChild(_pluginObj),element.parentNode&&(element.parentNode.replaceChild(_pluginObj,element),document.body.appendChild(element),element.style.visibility="hidden")}return element.pluginObj&&(element.pluginObj.bindEventListener("play",function(objvid){element.pluginObj&&(element.pluginObj.getAttribute("autowidth")&&objvid.videoWidth&&element.pluginObj.setAttribute("width",objvid.videoWidth),element.pluginObj.getAttribute("autoheight")&&objvid.videoHeight&&element.pluginObj.setAttribute("height",objvid.videoHeight))}),element.pluginObj.src=stream),element.pluginObj}return"audio"===element.nodeName.toLowerCase()?element:void 0},drawImage=function(context,video,x,y,width,height){var pluginObj=extractPluginObj(video);if(pluginObj&&pluginObj.isWebRtcPlugin&&pluginObj.videoWidth>0&&pluginObj.videoHeight>0)if("undefined"!=typeof pluginObj.getScreenShot){var bmpBase64=pluginObj.getScreenShot();if(bmpBase64){var image=new Image;image.onload=function(){context.drawImage(image,0,0,width,height)},image.src="data:image/png;base64,"+bmpBase64}}else{var imageData=context.createImageData(pluginObj.videoWidth,pluginObj.videoHeight);imageData&&(pluginObj.fillImageData(imageData),context.putImageData(imageData,x,y))}},MediaStreamTrack={};var getSourcesDelayed;MediaStreamTrack.getSources=function(gotSources){"complete"!==document.readyState?(console.log("readyState = "+document.readyState+", delaying getSources..."),getSourcesDelayed||(getSourcesDelayed=!0,attachEventListener(document,"readystatechange",function(){getSourcesDelayed&&"complete"==document.readyState&&(getSourcesDelayed=!1,getPlugin().getSources(gotSources))}))):getPlugin().getSources(gotSources)},RTCPeerConnection=function(configuration,constraints){return getPlugin().createPeerConnection(configuration,constraints)},RTCIceCandidate=function(RTCIceCandidateInit){return getPlugin().createIceCandidate(RTCIceCandidateInit)},RTCSessionDescription=function(RTCSessionDescriptionInit){return getPlugin().createSessionDescription(RTCSessionDescriptionInit)}}