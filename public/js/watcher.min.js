/*! webrtc 20-10-2016 */!function($){function initApp(){window.watcherApp=window.watcherApp||angular.module("watcherApp",[],function($locationProvider,$interpolateProvider){$locationProvider.html5Mode(!0),$interpolateProvider.startSymbol("[["),$interpolateProvider.endSymbol("]]")}),window.watcherApp.value("APP_VALUES",{EMAIL:"gogistics@gogistics-tw.com",BINARY_STREAM:null,FINGERPRINT:null}),window.watcherApp.config(function(){}),window.watcherApp.run(function(){}),window.watcherApp.service("dataProvider",function($http,APP_VALUES){this.getStreams=function(arg_url,arg_headers,arg_data){return $http({url:arg_url,method:"POST",data:arg_data,headers:arg_headers})}}),window.watcherApp.factory("client",function(){return new PeerManager("watcher")}),window.watcherApp.factory("fingerprintManager",function(){return new Fingerprint}),window.watcherApp.controller("watcherCtrl",["$scope","$window","APP_VALUES","dataProvider","client","fingerprintManager",function($scope,$window,APP_VALUES,dataProvider,client,fingerprintManager){APP_VALUES.FINGERPRINT=fingerprintManager.get(),client.localPeerInit();var ctrl=this;ctrl.broadcastStreams=[],ctrl.remoteStreamsDB=client.getRemoteStreamsDB(),ctrl.getStreamById=function(arg_id){for(var currentIndex,currentElem,minIndex=0,maxIndex=ctrl.broadcastStreams.length-1;minIndex<=maxIndex;){if(currentIndex=(minIndex+maxIndex)/2|0,currentElem=ctrl.broadcastStreams[currentIndex],currentElem.id<arg_id)minIndex=currentIndex+1;else{if(!(currentElem.id>arg_id))return ctrl.broadcastStreams[currentIndex];maxIndex=currentIndex-1}return null}},ctrl.loadData=function(){var customHeaders={current_cookie:$window.document.cookie,"Content-Type":"application/json"};dataProvider.getStreams("/streams",customHeaders,{user_type:"broadcast"}).success(function(data,status,headers,config){console.log("<---getStreams--->"),console.log(data);for(var latestStreams=data.broadcastStreams,ith=0,max=latestStreams.length;ith<max;ith++){var stream=ctrl.getStreamById(latestStreams[ith].id);latestStreams[ith].isPlaying=!!stream&&stream.isPlaying}ctrl.broadcastStreams=latestStreams}).error(function(data,status,headers,config){console.log("<---error of getStreams--->"),console.log(data)})},client.addExternalMechanism("load_data",ctrl.loadData),ctrl.loadData(),ctrl.view=function(arg_stream){if(arg_stream.isPlaying)console.log("remove remote stream..."),client.removeStream(arg_stream.id),arg_stream.isPlaying=!arg_stream.isPlaying;else{client.peerInit(arg_stream.id);arg_stream.isPlaying=!arg_stream.isPlaying}}}])}angular.element(document).ready(function(){angular.bootstrap(document.body,["watcherApp"])}),initApp()}(jQuery);