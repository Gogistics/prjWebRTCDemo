/*! webrtc 28-08-2016 */!function($){function initApp(){window.broadcastApp=window.broadcastApp||angular.module("broadcastApp",[],function($locationProvider,$interpolateProvider){$locationProvider.html5Mode(!0),$interpolateProvider.startSymbol("[["),$interpolateProvider.endSymbol("]]")}),window.broadcastApp.value("APP_VALUES",{EMAIL:"gogistics@gogistics-tw.com",MEDIA_CONFIG:{audio:!0,video:{optional:[{sourceId:"X978DoubangoTelecomScreenCapturer785"}]}},LOCAL_STREAM:null}),window.broadcastApp.config(function(){}),window.broadcastApp.run(function(){window.binaryClient=window.binaryClient||new BinaryClient("ws://45.79.106.150:8888"),window.binaryClient.on("open",function(stream){console.log(stream),window.myBinaryStream=window.binaryClient.createStream({from:"broadcast"}),window.myBinaryStream.on("data",function(data){console.log(data)})})}),window.broadcastApp.service("dataProvider",function($http,APP_VALUES){this.getStreams=function(arg_url,arg_headers,arg_data){return $http({url:arg_url,method:"POST",data:arg_data,headers:arg_headers})}}),window.broadcastApp.factory("client",function(){return new PeerManager}),window.broadcastApp.factory("camera",["$window","$rootScope","client","APP_VALUES",function($window,$rootScope,client,APP_VALUES){var camera={};return camera.preview=$window.document.getElementById("localVideo"),camera.isOn=!1,camera.start=function(){return requestUserMedia(APP_VALUES.MEDIA_CONFIG).then(function(stream){APP_VALUES.LOCAL_STREAM=stream,attachMediaStream(camera.preview,stream),client.setLocalStream(stream),camera.stream=stream,camera.isOn=!0,$rootScope.$broadcast("cameraIsOn",!0),console.log("OnSuccess...")},function(err){console.log("OnError...")}).catch(Error("Failed to get access to local media"))},camera.stop=function(){return new Promise(function(resolve,reject){try{camera.stream.stop(),camera.preview.src="",resolve()}catch(err){reject(err)}}).then(function(result){camera.isOn=!1,$rootScope.$broadcast("cameraIsOn",!1)})},camera}]),window.broadcastApp.controller("broadcastCtrl",["$scope","$window","dataProvider","client","camera",function($scope,$window,dataProvider,client,camera){var ctrl=this;ctrl.name="WebRTC Broadcast",ctrl.link="",ctrl.cameraIsOn=!1,ctrl.isFirefox=!!navigator.mozGetUserMedia,ctrl.isStartRecordingBtnDisabled=!1,ctrl.isStopRecordingBtnDisabled=!0,ctrl.userType=null,$scope.$on("cameraIsOn",function(event,data){console.log(data),$scope.$apply(function(){ctrl.cameraIsOn=data})}),ctrl.init=function(arg_user_type){ctrl.userType=arg_user_type},ctrl.toggleCam=function(){ctrl.cameraIsOn?camera.stop().then(function(result){client.send("leave",{name:ctrl.name,user_type:"broadcast"}),client.setLocalStream(null),$window.location.reload()}).catch(function(err){console.log(err)}):(console.log("start camera..."),camera.start().then(function(result){ctrl.link=$window.location.host+"/"+client.getId(),client.send("readyToStream",{name:ctrl.name,user_type:ctrl.userType})}))},ctrl.startRecording=function(){},ctrl.stopRecording=function(){}}])}angular.element(document).ready(function(){angular.bootstrap(document.body,["broadcastApp"])}),initApp()}(jQuery);